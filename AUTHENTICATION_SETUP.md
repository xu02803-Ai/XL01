# è®¤è¯å’Œè®¢é˜…ç³»ç»Ÿå®æ–½æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend (React)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ LoginPage    â”‚  â”‚ ProfilePage   â”‚            â”‚
â”‚  â”‚ SubscriptionPage                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â†“                â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  AuthContext (State Management)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ JWT Token in Authorization Header
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backend APIs (Node.js + Vercel)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ /api/auth    â”‚  â”‚ /api/user    â”‚            â”‚
â”‚  â”‚ (Register)   â”‚  â”‚ (Profile Mgmt)           â”‚
â”‚  â”‚ (Login)      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ /api/subscription                â”‚           â”‚
â”‚  â”‚ (Plans)                          â”‚           â”‚
â”‚  â”‚ (Checkout)   â”‚ â”€â”€â†’ Stripe â†â”€â”€  â”‚           â”‚
â”‚  â”‚ (Cancel)     â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Supabase (PostgreSQL Database)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ users        â”‚  â”‚ subscriptions â”‚            â”‚
â”‚  â”‚ - id         â”‚  â”‚ - id         â”‚            â”‚
â”‚  â”‚ - email      â”‚  â”‚ - user_id    â”‚            â”‚
â”‚  â”‚ - username   â”‚  â”‚ - plan       â”‚            â”‚
â”‚  â”‚ - password   â”‚  â”‚ - status     â”‚            â”‚
â”‚  â”‚ - avatar_url â”‚  â”‚ - stripe_id  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ api_usage    â”‚                              â”‚
â”‚  â”‚ (Usage tracking)                â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹æ­¥éª¤

### ç¬¬1æ­¥ï¼šSupabase è®¾ç½®ï¼ˆ5-10 åˆ†é’Ÿï¼‰

1. **åˆ›å»ºè´¦æˆ·**
   - è®¿é—® https://supabase.com
   - ç”¨ GitHub ç™»å½•
   - åˆ›å»ºæ–°é¡¹ç›®

2. **åˆ›å»ºæ•°æ®åº“è¡¨**
   - æ‰“å¼€ SQL Editor
   - æ‰§è¡Œ `supabase.md` ä¸­çš„ SQL è„šæœ¬
   - ç¡®è®¤è¡¨åˆ›å»ºæˆåŠŸ

3. **è·å– API å¯†é’¥**
   - è¿›å…¥ Project Settings â†’ API
   - å¤åˆ¶ "Project URL"
   - å¤åˆ¶ "anon public key"
   - å¤åˆ¶ "service_role key"

### ç¬¬2æ­¥ï¼šStripe è®¾ç½®ï¼ˆ10-15 åˆ†é’Ÿï¼‰

1. **åˆ›å»º Stripe è´¦æˆ·**
   - è®¿é—® https://stripe.com
   - åˆ›å»ºè´¦æˆ·å¹¶å®ŒæˆéªŒè¯

2. **åˆ›å»ºäº§å“å’Œä»·æ ¼**
   ```
   Basic Plan
   - ä»·æ ¼: $9.99/æœˆ
   - è®°å½• Price ID: price_xxxxx

   Pro Plan
   - ä»·æ ¼: $29.99/æœˆ
   - è®°å½• Price ID: price_xxxxx
   ```

3. **è·å– API å¯†é’¥**
   - è¿›å…¥ Developers â†’ API Keys
   - å¤åˆ¶ "Secret Key" (sk_live_xxxxx)
   - å¤åˆ¶ "Publishable Key" (pk_live_xxxxx)

### ç¬¬3æ­¥ï¼šéƒ¨ç½²åˆ° Vercel

1. **æ·»åŠ ç¯å¢ƒå˜é‡**
   ```
   åœ¨ Vercel é¡¹ç›® Settings â†’ Environment Variables ä¸­æ·»åŠ ï¼š

   SUPABASE_URL=https://xxxxx.supabase.co
   SUPABASE_ANON_KEY=your_anon_key
   SUPABASE_SERVICE_KEY=your_service_key
   JWT_SECRET=ï¼ˆä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ï¼‰
   STRIPE_SECRET_KEY=sk_live_xxxxx
   STRIPE_PUBLIC_KEY=pk_live_xxxxx
   STRIPE_BASIC_PRICE_ID=price_xxxxx
   STRIPE_PRO_PRICE_ID=price_xxxxx
   ```

2. **é‡æ–°éƒ¨ç½²**
   - åœ¨ Vercel dashboard ç‚¹å‡» "Redeploy"

### ç¬¬4æ­¥ï¼šæµ‹è¯•ç³»ç»Ÿ

1. **è®¿é—®åº”ç”¨**
   - å‰å¾€ `/login` é¡µé¢
   - ç‚¹å‡» "Sign Up" åˆ›å»ºè´¦æˆ·
   - ä½¿ç”¨ email + password æ³¨å†Œ

2. **æµ‹è¯•è®¢é˜…åŠŸèƒ½**
   - è¿›å…¥ `/subscription` é¡µé¢
   - é€‰æ‹© "Basic" æˆ– "Pro" è®¡åˆ’
   - ä½¿ç”¨ Stripe æµ‹è¯•å¡å·ï¼š
     ```
     4242 4242 4242 4242
     ä»»æ„æœªæ¥æ—¥æœŸ (å¦‚ 12/25)
     ä»»æ„ CVC (å¦‚ 123)
     ```

3. **éªŒè¯ç”¨æˆ·èµ„æ–™**
   - è¿›å…¥ `/profile` æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
   - ä¿®æ”¹ username å’Œ avatar
   - ä¿å­˜æ›´æ”¹

## ğŸ“‹ API æ–‡æ¡£

### Authentication

#### æ³¨å†Œ (POST /api/auth?action=register)
```json
Request:
{
  "email": "user@example.com",
  "username": "johndoe",
  "password": "securepassword"
}

Response:
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "username": "johndoe"
  },
  "token": "jwt_token_here"
}
```

#### ç™»å½• (POST /api/auth?action=login)
```json
Request:
{
  "email": "user@example.com",
  "password": "securepassword"
}

Response:
{
  "success": true,
  "user": { ... },
  "subscription": { ... },
  "token": "jwt_token_here"
}
```

### User Management

#### è·å–èµ„æ–™ (GET /api/user?action=profile)
```
Headers:
Authorization: Bearer {token}

Response:
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "username": "johndoe",
    "avatar_url": "https://...",
    "created_at": "2025-11-28..."
  }
}
```

#### æ›´æ–°èµ„æ–™ (PUT /api/user?action=profile)
```
Headers:
Authorization: Bearer {token}

Request:
{
  "username": "newusername",
  "avatar_url": "https://..."
}
```

#### è·å–è®¢é˜… (GET /api/user?action=subscription)
```
Headers:
Authorization: Bearer {token}

Response:
{
  "success": true,
  "subscription": {
    "id": "uuid",
    "plan": "pro",
    "status": "active",
    "current_period_end": "2025-12-28..."
  }
}
```

### Subscriptions

#### è·å–è®¡åˆ’åˆ—è¡¨ (GET /api/subscription?action=plans)
```
Response:
{
  "success": true,
  "plans": [
    {
      "id": "free",
      "name": "Free",
      "price": 0,
      "requests_per_day": 10
    },
    ...
  ]
}
```

#### åˆ›å»ºæ”¯ä»˜ä¼šè¯ (POST /api/subscription?action=create-checkout)
```
Headers:
Authorization: Bearer {token}

Request:
{
  "plan": "pro"
}

Response:
{
  "success": true,
  "url": "https://checkout.stripe.com/...",
  "sessionId": "cs_test_..."
}
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

1. **JWT å¯†é’¥**
   - ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²
   - å®šæœŸè½®æ¢
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 

2. **å¯†ç **
   - ä½¿ç”¨ bcryptjs å“ˆå¸Œï¼ˆå·²å®ç°ï¼‰
   - æœ€å°‘ 8 å­—ç¬¦è¦æ±‚ï¼ˆå·²å®ç°ï¼‰
   - ä¼ è¾“æ—¶ä½¿ç”¨ HTTPS

3. **ä»¤ç‰Œ**
   - å­˜å‚¨åœ¨ localStorageï¼ˆå®¢æˆ·ç«¯ï¼‰
   - åœ¨ Authorization å¤´ä¸­ä¼ è¾“
   - 30 å¤©è¿‡æœŸæ—¶é—´ï¼ˆå¯è°ƒæ•´ï¼‰

4. **Stripe**
   - ä½¿ç”¨ Secret Keyï¼ˆä»…åç«¯ï¼‰
   - éªŒè¯ webhook ç­¾å
   - ä¸åœ¨å‰ç«¯æš´éœ² Secret Key

5. **Supabase**
   - å¯ç”¨ Row Level Security (RLS)
   - ä½¿ç”¨ Service Keyï¼ˆä»…åç«¯ï¼‰
   - å®šæœŸå¤‡ä»½

## ğŸ“Š ä½¿ç”¨é‡é™åˆ¶

| è®¡åˆ’ | æ¯æ—¥è¯·æ±‚ | åŠŸèƒ½ |
|------|---------|------|
| Free | 10 | åŸºç¡€åŠŸèƒ½ |
| Basic | 100 | é«˜çº§åŠŸèƒ½ + é‚®ä»¶æ”¯æŒ |
| Pro | 1000 | æ‰€æœ‰åŠŸèƒ½ + ä¼˜å…ˆæ”¯æŒ + API è®¿é—® |

## ğŸ› æ•…éšœæ’é™¤

### ç™»å½•å¤±è´¥
- æ£€æŸ¥ Supabase è¿æ¥
- éªŒè¯ JWT_SECRET ç¯å¢ƒå˜é‡
- æ£€æŸ¥ bcryptjs ä¾èµ–æ˜¯å¦å®‰è£…

### Stripe æ”¯ä»˜å¤±è´¥
- éªŒè¯ STRIPE_SECRET_KEY
- ç¡®ä¿ Price ID æ­£ç¡®
- æ£€æŸ¥ Stripe è´¦æˆ·çŠ¶æ€

### æ•°æ®åº“è¿æ¥é”™è¯¯
- éªŒè¯ SUPABASE_URL å’Œå¯†é’¥
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤è¡¨å·²åˆ›å»º

## ğŸ”§ è¿›ä¸€æ­¥å®šåˆ¶

### æ·»åŠ ç¤¾äº¤ç™»å½•
å¯ä»¥é›†æˆ OAuth æä¾›å•†ï¼š
- Google OAuth
- GitHub OAuth
- Discord OAuth

### è‡ªå®šä¹‰æ”¯ä»˜æµç¨‹
- æ·»åŠ æŠ˜æ‰£ä»£ç 
- å®ç°æœˆåº¦/å¹´åº¦åˆ‡æ¢
- æ·»åŠ å‘ç¥¨ç®¡ç†

### é«˜çº§åŠŸèƒ½
- ä¸¤æ­¥éªŒè¯ (2FA)
- å›¢é˜Ÿç®¡ç†
- API å¯†é’¥ç”Ÿæˆ
- ä½¿ç”¨é‡åˆ†æä»ªè¡¨æ¿

## ğŸ“ è·å–å¸®åŠ©

- Supabase æ–‡æ¡£: https://supabase.com/docs
- Stripe æ–‡æ¡£: https://stripe.com/docs
- JWT æŒ‡å—: https://jwt.io
