<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/8/8a/Google_Gemini_logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#0f172a" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TechPulse Daily | 每日科技新闻</title>
    <link rel="manifest" href="./manifest.json" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Noto Sans SC"', 'sans-serif'],
              mono: ['"JetBrains Mono"', 'monospace'],
            },
            colors: {
              tech: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                500: '#0ea5e9',
                600: '#0284c7',
                900: '#0c4a6e',
              },
              dark: {
                bg: '#0f172a',
                card: '#1e293b',
                border: '#334155'
              }
            }
          }
        }
      }
    </script>
    <style>
      body {
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      /* Fallback/Error Screen Styles */
      #app-startup-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background-color: #0f172a;
        color: white;
        z-index: 9999;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 2rem;
        text-align: center;
        font-family: sans-serif;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react-markdown": "https://aistudiocdn.com/react-markdown@^10.1.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>

    <!-- Error/Loading Overlay -->
    <div id="app-startup-overlay">
      <div id="loading-spinner" class="flex flex-col items-center">
         <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
         <p class="text-blue-300">Initializing TechPulse...</p>
      </div>
      
      <div id="local-file-error" class="hidden flex-col items-center max-w-lg">
        <svg class="w-20 h-20 text-red-500 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
        <h2 class="text-3xl font-bold mb-4">无法在本地运行 (Cannot Run Locally)</h2>
        <p class="text-slate-400 mb-8 text-lg leading-relaxed">
          您正在尝试直接打开源代码文件 (<code>file://</code>)。<br/>
          现代 Web 应用包含 TypeScript 代码，浏览器无法直接读取硬盘上的这些文件，必须通过服务器运行。
        </p>
        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 text-left text-slate-300 w-full shadow-2xl">
          <strong class="text-white text-lg block mb-3">✅ 正确的使用方法 (How to use):</strong>
          <ol class="list-decimal list-inside space-y-3">
            <li>请回到 <b>在线网页版</b> (Online Website)。</li>
            <li>点击页面右上角的 <b>"Install App"</b> 按钮。</li>
            <li>或者点击浏览器地址栏右侧的 <b>"安装图标"</b>。</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Critical Startup Script -->
    <script>
      const overlay = document.getElementById('app-startup-overlay');
      const errorContent = document.getElementById('local-file-error');
      const spinner = document.getElementById('loading-spinner');

      // 1. Check for file:// protocol immediately
      if (window.location.protocol === 'file:') {
        overlay.style.display = 'flex';
        spinner.style.display = 'none';
        errorContent.classList.remove('hidden');
        errorContent.style.display = 'flex';
        throw new Error("Local file execution blocked.");
      }

      // 2. Loading State for Online Version
      // Show loading screen briefly until React mounts
      overlay.style.display = 'flex';
      
      // Safety timeout: If React doesn't mount in 3 seconds, show generic error
      setTimeout(() => {
        const root = document.getElementById('root');
        if (!root || root.childElementCount === 0) {
           // Only show error if we are NOT on file:// (which is handled above)
           if (window.location.protocol !== 'file:') {
              spinner.innerHTML = '<p class="text-red-400">Loading timeout. Please refresh.</p>';
           }
        } else {
           // React mounted successfully
           overlay.style.display = 'none';
        }
      }, 3000);

      // Listen for React Mount Event (Optional, if we added it to index.tsx)
      // Or simply wait for the module to load below
    </script>

    <script type="module" src="./index.tsx"></script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>